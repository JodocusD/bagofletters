"0","#import section data"
"0","# dbConnect() call"
"0","library(RMySQL)"
"0","con <- dbConnect(RMySQL::MySQL(), "
"0","                 dbname = 'rijk9_imkserver', "
"0","                 host = ""qs3990.pair.com"", "
"0","                 port = 0000,"
"0","                 user = ""rijk9_12"","
"0","                 password = ""efiYjhFV"")"
"0","#inspect tables"
"0","#dbListTables(con)"
"0","library(DBI)"
"0","cutofdate = c('2016-12-31')"
"0","cmrallday <- dbGetQuery(con, ""SELECT  `date`, `ad_slot_id`, `channel_id`, `count` FROM `statistics_slots` WHERE `ad_slot_id` IN( '2',  '13',  '22',  '33', '381', '377', '380', '378', '379',  '42',  '52',  '66',  '63',  '61', '317', '144', '234', '240', '242', '246', '244', '248', '250', '216', '313', '318', '230', '210') AND `date` > '2016-12-31' AND `publisher_id` = 3 "")"
"0","cmrallday$date <- as.Date(cmrallday$date)"
"0","cmrallday$ad_slot_id <- as.numeric(cmrallday$ad_slot_id)"
"0","#disconnect DB"
"0","dbDisconnect(con)"
"1","[1]"
"1"," TRUE"
"1","
"
"0","#work with AdSlotKey file for labeling sections"
"0","library(readr)"
"0","read_csv(""AdSlotKey.csv"") -> slotkey"
"0","slotkey$channel_id <- NULL"
"0","slotkey$ad_slot_id <- as.numeric(slotkey$ad_slot_id)"
"0","slotkey$section <- factor(slotkey$section, levels = c('HomePage', 'News', 'Entertainment', 'Sports', 'World', 'Business', 'Opinions', 'Members', 'Country', 'Jobs', 'Real Estate', 'Telephone Directory', 'Used Cars', 'Trucks')) "
"0","#label data with sectionkey and organise"
"0","library(dplyr)"
"0","sectjoin <- left_join(cmrallday, slotkey, by = ('ad_slot_id'))"
"0","sectjoin$medium <- ifelse(sectjoin$channel_id == 1, 'Desktop', 'Mobile')"
"0","sectjoin$count <- as.numeric(sectjoin$count)"
"0","##!!!remove outliers  (method just copied). Select 1 of 2 lines. Top = filter, bottom is NO FILTER"
"0","#sectclean <- sectjoin %>% group_by(ad_slot_id) %>% filter(!(abs(count - median(count)) > 3*sd(count)))"
"0","sectclean <- sectjoin"
"0","#Top sections"
"0","library(data.table)"
"0","sect1 <- as.data.table(filter(sectclean, section %in% c('HomePage', 'Sports', 'Entertainment', 'Business', 'World')))"
"0","sect1[(ad_slot_id == 317 & date < '2016-04-14'), count := count/1.5] "
"0","sect1$section <- factor(sect1$section, levels = c('HomePage', 'News', 'Entertainment', 'Sports', 'World', 'Business', 'Opinions', 'Members', 'Country', 'Jobs', 'Real Estate', 'Telephone Directory', 'Used Cars', 'Trucks')) "
"0","#2nd Tier sections"
"0","sect2 <- filter(sectclean, section %in% c('Opinions', 'Members', 'Country', 'Jobs', 'Real Estate', 'Telephone Directory')) "
"0","sect2$section <- factor(sect2$section, levels = c('HomePage', 'News', 'Entertainment', 'Sports', 'World', 'Business', 'Opinions', 'Members', 'Country', 'Jobs', 'Real Estate', 'Telephone Directory', 'Used Cars', 'Trucks')) "
"0","#Section Plots"
"0","#testplots based on cmrallday"
"0","library(ggplot2)"
"0","library(RColorBrewer)"
"0","library(ggthemes)"
"0","cols <- brewer.pal(8 ,""Set1"")"
"0","#PLOT top and bottom sections"
"0","# #Low Indiv. y-axis"
"0","# ggplot(data = sectlowsect, aes(date, count, col = section)) +  "
"0","#   geom_point(alpha = 1) + "
"0","#   labs(title ='Daily PageViews for Low Volume Sections: Individual y-axis', y = ""pageviews"")  +"
"0","#   theme_light() +"
"0","#   scale_color_manual(values = cols) +"
"0","#   facet_grid(section ~ medium, scales = 'free_y') "
"0","#High Indiv y-axis"
"0","# ggplot(data = secttopsect, aes(date, count, col = section)) + "
"0","#   geom_point(alpha = 1) + "
"0","#   labs(title ='Daily PageViews for High Volume Sections: Individual y-axis', y = ""pageviews"")  +"
"0","#   theme_light() +"
"0","#   scale_color_manual(values = cols) +"
"0","#   facet_grid(section ~ medium, scales = 'free_y') "
"0","sectionofinterest <- c('News')"
"0","library(data.table)"
"0","singlesect <- as.data.table(filter(sectclean, section %in% sectionofinterest))"
"0","singlesect$section <- factor(singlesect$section, levels = sectionofinterest)"
"0","maxyax_singlsect <- signif(max(singlesect$count)*1.1, 2)"
"0","ticksyax_singlsect <- floor(round(max(singlesect$count)*1.1))"
"0","p1sect <- ggplot(data = singlesect, aes(date, count, col = section)) +"
"0","  geom_point(alpha = .8) +"
"0","  labs(title = paste('Daily PageViews for', sectionofinterest, sep = ' '), y = ""pageviews"")  +"
"0","  theme_light() +"
"0","  theme(axis.text.x = element_text(angle = 90), legend.position=""none"") +"
"0","  scale_y_continuous(breaks = seq(0, maxyax_singlsect, by = maxyax_singlsect/5), limits = c(0, maxyax_singlsect)) +"
"0","  scale_color_manual(values = cols) +"
"0","  facet_grid(section ~ medium)"
"0","  "
"0","plot(p1sect)"
